<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Or√ßaf√°cil METLAL</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* Estilo moderno */
    body { font-family: 'Inter', sans-serif; background-color:#f4f6f8; margin:0; padding:0; color:#333; }
    .container { max-width:850px; margin:30px auto; background:#fff; border-radius:12px; padding:30px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
    .empresa-info { text-align:center; margin-bottom:20px; }
    .empresa-info img { max-width:200px; margin-bottom:10px; }
    h2 { color:#0056b3; }
    label { display:block; margin-top:10px; font-weight:600; }
    input, select { width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; margin-bottom:14px; font-size:14px; }
    button { background:#0056b3; color:#fff; padding:12px 20px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition: background .3s; }
    button:hover { background:#003f88; }
    #itensOrcamento { margin-top:30px; background:#f1f3f5; border-radius:10px; padding:20px; }
    ul { padding-left:20px; }
    ul li { margin-bottom:12px; line-height:1.5; }
    .total { font-size:18px; font-weight:bold; color:green; }
    .assinaturas { margin-top:40px; }
    .assinaturas div { display:inline-block; width:45%; text-align:center; margin-top:40px;}
    .assinaturas div hr { border:0; border-top:1px solid #ccc; margin-bottom:6px;}
    @media (max-width:600px){ .assinaturas div { display:block; width:100%; margin-bottom:40px; } }
  </style>
</head>
<body>

<div class="container">
  <div class="empresa-info">
    <img src="logo-metlal.png" alt="Logo METLAL">
    <h2></h2>
    <p>CNPJ: 00.000.000/0001-00</p>
    <p>Rua Juruc√™,‚ÄØ78 ‚Äì Col√©gio ‚Äì Rio de Janeiro ‚Äì RJ</p>
    <p>CEP: 21545‚Äë170</p>
  </div>

  <form id="orcamentoForm" onsubmit="return false;">
    <label>Nome do Cliente:</label>
    <input id="cliente" type="text" required>

    <label>N¬∫ do Or√ßamento:</label>
    <input id="numero" type="text" readonly>

    <label>Data:</label>
    <input id="data" type="date" readonly>

    <label>Produto:</label>
    <select id="produto"><option value="">Carregando...</option></select>

    <label>Largura (m):</label><input id="largura" type="number" step="0.01">
    <label>Altura (m):</label><input id="altura" type="number" step="0.01">
    <label>Comprimento (m):</label><input id="comprimento" type="number" step="0.01">
    <label>Quantidade:</label><input id="quantidade" type="number" min="1" value="1" required>

    <button type="button" onclick="adicionarItem()">‚ûï Adicionar ao Or√ßamento</button>
  </form>

  <div id="itensOrcamento"></div>

  <div style="text-align:center; margin-top:20px;">
    <button onclick="gerarPDF()">üì• Baixar PDF</button>
  </div>
</div>

<script>
  const tabelaPreco = {};
  let itens = [];
  const sheetID = "1HhXN32p7V9NtzuuG-Xr03uBts_W2yNLBqosnZuWwGn8";
  const sheetName = "P√°gina1";
  const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${sheetName}`;

  window.onload = () => {
    carregarPrecos();
    document.getElementById("data").value = new Date().toISOString().slice(0,10);
    document.getElementById("numero").value = "ORC-" + Date.now().toString().slice(-6);
  };

  function carregarPrecos() {
    fetch(url).then(r => r.text()).then(text => {
      const start = text.indexOf('{');
      const end = text.lastIndexOf('}') + 1;
      const json = JSON.parse(text.slice(start, end));
      const rows = json.table.rows;
      const sel = document.getElementById("produto");
      sel.innerHTML = "<option value=''>Selecione...</option>";
      rows.forEach(r => {
        const nome = r.c[0]?.v;
        const preco = parseFloat(r.c[1]?.v);
        const tipo = (r.c[2]?.v || '').toLowerCase();
        if (nome && preco && tipo) {
          tabelaPreco[nome.toLowerCase()] = { preco, tipo };
          const o = document.createElement("option");
          o.value = nome.toLowerCase();
          o.textContent = nome;
          sel.appendChild(o);
        }
      });
    }).catch(err => {
      console.error(err);
      alert("Erro ao carregar produtos.");
    });
  }

  function adicionarItem() {
    const prod = document.getElementById("produto").value;
    const largura = parseFloat(document.getElementById("largura").value);
    const altura = parseFloat(document.getElementById("altura").value);
    const comp = parseFloat(document.getElementById("comprimento").value);
    const qtd = parseInt(document.getElementById("quantidade").value);
    if (!prod || isNaN(qtd)) return alert("Campos obrigat√≥rios faltando.");

    const { preco, tipo } = tabelaPreco[prod];
    let total=0, desc="";
    if (tipo==="m2") {
      if (isNaN(largura)||isNaN(altura)) return alert("Informe largura e altura para m¬≤.");
      const area=largura*altura;
      total = preco*area*qtd;
      desc=${largura}√ó${altura}m ¬∑ qty ${qtd};
    } else if (tipo==="metro") {
      if (isNaN(comp)) return alert("Informe comprimento.");
      total = preco*comp*qtd;
      desc=${comp}m ¬∑ qty ${qtd};
    } else if (tipo==="unidade") {
      total = preco*qtd;
      desc=qty ${qtd};
    }
    itens.push({ nome:prod, preco, total, desc });
    atualizarOrcamento();
  }

  function atualizarOrcamento() {
    const div = document.getElementById("itensOrcamento");
    let html="<h3>Itens do Or√ßamento</h3><ul>";
    let soma=0;
    itens.forEach((it,i)=>{
      html += <li><strong>${it.nome}</strong> ${it.desc} = R$${it.total.toFixed(2)} <button onclick="remover(${i})">‚ùå</button></li>;
      soma+=it.total;
    });
    html += </ul><p class="total">Total: R$ ${soma.toFixed(2)}</p>;
    html += <div class="assinaturas"><div><hr><p>Assinatura do Cliente</p></div><div><hr><p>Assinatura do Vendedor</p></div></div>;
    div.innerHTML = html;
  }

  function remover(i) { itens.splice(i,1); atualizarOrcamento(); }

  function gerarPDF() {
    const cli = document.getElementById("cliente").value;
    const num = document.getElementById("numero").value;
    const dat = document.getElementById("data").value;
    if (!cli || itens.length===0) return alert("Digite o cliente e adicione itens.");

    const doc = new jsPDF();
    let y=10;
    doc.setFontSize(12);
    doc.text("METLAL METAL√öRGICA LADEIRA LTDA",10,y); y+=6;
    doc.text("CNPJ: 00.000.000/0001-00",10,y); y+=6;
    doc.text("Rua Juruc√™, 78 ‚Äì Col√©gio ‚Äì RJ",10,y); y+=6;
    doc.text("CEP: 21545‚Äë170",10,y); y+=10;

    doc.setFontSize(14);
    doc.text("OR√áAMENTO",105,y,null,null,"center"); y+=10;

    doc.setFontSize(12);
    doc.text(Cliente: ${cli},10,y); y+=6;
    doc.text(N√∫mero: ${num},10,y); y+=6;
    doc.text(Data: ${dat},10,y); y+=10;

    itens.forEach(it=>{
      doc.text(- ${it.nome} | ${it.desc} | R$${it.total.toFixed(2)},10,y);
      y+=7;
    });
    const tot= itens.reduce((s,a)=>s+a.total,0);
    y+=5; doc.setFontSize(13);
    doc.text(TOTAL GERAL: R$ ${tot.toFixed(2)},10,y); y+=20;
    doc.line(20,y,90,y); doc.text("Assinatura do Cliente",30,y+5);
    doc.line(120,y,190,y); doc.text("Assinatura do Vendedor",130,y+5);
    doc.save(orc_${num}.pdf);
  }
</script>

</body>
</html>