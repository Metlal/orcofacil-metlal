<!DOCTYPE html>
<html>
<head>
  <title>Orçamento de Produtos</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button, select, textarea { margin: 5px 0; padding: 5px; width: 100%; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h1>Gerador de Orçamento</h1>

  <label for="numeroProposta">Número da Proposta:</label>
  <input type="text" id="numeroProposta" placeholder="Ex: 2025-001" />

  <label for="descricaoProduto">Descrição do Produto:</label>
  <textarea id="descricaoProduto" placeholder="Descrição detalhada do produto"></textarea>

  <label for="produto">Produto:</label>
  <input type="text" id="produto" placeholder="Ex: Portão de ferro" />

  <label for="quantidade">Quantidade:</label>
  <input type="number" id="quantidade" min="1" value="1" />

  <label for="precoUnitario">Preço Unitário (R$):</label>
  <input type="number" id="precoUnitario" step="0.01" />

  <button onclick="adicionarProduto()">Adicionar ao Orçamento</button>

  <h2>Itens do Orçamento</h2>
  <table id="tabelaOrcamento">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Quantidade</th>
        <th>Preço Unitário</th>
        <th>Subtotal</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Total: R$ <span id="valorTotal">0.00</span></h3>
  <input type="hidden" id="valorExtenso" />

  <button onclick="gerarPDF()">Gerar PDF</button>

  <script>
    const tabela = document.querySelector('#tabelaOrcamento tbody');
    let total = 0;

    function adicionarProduto() {
      const produto = document.getElementById('produto').value;
      const quantidade = parseInt(document.getElementById('quantidade').value);
      const preco = parseFloat(document.getElementById('precoUnitario').value);

      if (!produto || isNaN(quantidade) || isNaN(preco)) {
        alert("Preencha todos os campos corretamente.");
        return;
      }

      const subtotal = quantidade * preco;
      total += subtotal;

      const row = tabela.insertRow();
      row.insertCell(0).innerText = produto;
      row.insertCell(1).innerText = quantidade;
      row.insertCell(2).innerText = preco.toFixed(2);
      row.insertCell(3).innerText = subtotal.toFixed(2);

      document.getElementById('valorTotal').innerText = total.toFixed(2);
      document.getElementById('valorExtenso').value = converterParaExtenso(total);
      
      // Limpar campos
      document.getElementById('produto').value = "";
      document.getElementById('quantidade').value = 1;
      document.getElementById('precoUnitario').value = "";
    }

    function gerarPDF() {
      const numeroProposta = document.getElementById('numeroProposta').value;
      const descricao = document.getElementById('descricaoProduto').value;
      const valorExtenso = document.getElementById('valorExtenso').value;
      const conteudoTabela = tabela.innerHTML;
      const total = document.getElementById('valorTotal').innerText;

      let janela = window.open('', '', 'width=800,height=600');
      janela.document.write(`<html><head><title>Orçamento</title></head><body>`);
      janela.document.write(`<h2>Proposta Nº: ${numeroProposta}</h2>`);
      janela.document.write(`<p><strong>Descrição do Produto:</strong> ${descricao}</p>`);
      janela.document.write(`<table border='1' style='width:100%; border-collapse: collapse;'><thead><tr>
        <th>Produto</th><th>Quantidade</th><th>Preço Unitário</th><th>Subtotal</th></tr></thead><tbody>${conteudoTabela}</tbody></table>`);
      janela.document.write(`<h3>Total: R$ ${total}</h3>`);
      janela.document.write(`<p><strong>Valor por extenso:</strong> ${valorExtenso}</p>`);
      janela.document.write(`</body></html>`);
      janela.document.close();
      janela.print();
    }

    function converterParaExtenso(valor) {
      const unidades = ["", "um", "dois", "três", "quatro", "cinco", "seis", "sete", "oito", "nove"];
      const especiais = ["dez", "onze", "doze", "treze", "quatorze", "quinze", "dezesseis", "dezessete", "dezoito", "dezenove"];
      const dezenas = ["", "", "vinte", "trinta", "quarenta", "cinquenta", "sessenta", "setenta", "oitenta", "noventa"];
      const centenas = ["", "cem", "duzentos", "trezentos", "quatrocentos", "quinhentos", "seiscentos", "setecentos", "oitocentos", "novecentos"];

      function extenso(n) {
        if (n === 0) return "zero";
        let parteInteira = Math.floor(n);
        let parteDecimal = Math.round((n - parteInteira) * 100);

        function escreverNumero(num) {
          if (num === 100) return "cem";
          let c = Math.floor(num / 100);
          let d = Math.floor((num % 100) / 10);
          let u = num % 10;
          let str = "";

          if (c > 0) {
            str += c === 1 && d === 0 && u === 0 ? "cem" : centenas[c];
            if (d > 0 || u > 0) str += " e ";
          }

          if (d === 1) {
            str += especiais[u];
          } else {
            if (d > 1) str += dezenas[d];
            if (u > 0) str += (d > 1 ? " e " : "") + unidades[u];
          }

          return str;
        }

        let resultado = escreverNumero(parteInteira) + " reais";
        if (parteDecimal > 0) {
          resultado += " e " + escreverNumero(parteDecimal) + " centavos";
        }
        return resultado;
      }

      return extenso(valor);
    }
  </script>
</body>
</html>
