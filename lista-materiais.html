<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f8f9fa;
      }
      .card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      h2 {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      label {
        margin-right: 10px;
      }
      input[type="text"] {
        padding: 5px;
        margin-right: 10px;
      }
      button {
        padding: 6px 12px;
        cursor: pointer;
        background-color: #007bff;
        border: none;
        color: white;
        border-radius: 4px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #007bff;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h2>üì¶ Libera√ß√£o de Materiais (BOM)</h2>
      <label for="orcamento">N¬∫ do Or√ßamento</label>
      <input type="text" id="orcamento" placeholder="Ex: MT0009" />
      <button onclick="gerarListaMateriais()">Gerar Lista de Materiais</button>
      <div id="resultado"></div>
    </div>

    <script>
      async function gerarListaMateriais() {
        const orcamento = document.getElementById("orcamento").value.trim();
        const resultadoDiv = document.getElementById("resultado");
        resultadoDiv.innerHTML = "Buscando dados...";

        try {
          const response = await fetch(
            "https://script.google.com/macros/s/AKfycbxse_rOXIAZrMDrr5U3tWzCBJUy-yTkL6DQU1O8uG5xJwxds3l8VDISL9vKVbeUSxUy/exec?orcamento=" +
              encodeURIComponent(orcamento)
          );
          const data = await response.json();

          if (!data || data.length === 0) {
            resultadoDiv.innerHTML = "Nenhum dado encontrado para este or√ßamento.";
            return;
          }

          let html = `
            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Descri√ß√£o</th>
                  <th>Qtd Pe√ßas</th>
                  <th>Comp. por Pe√ßa (mm)</th>
                  <th>Barra Padr√£o (mm)</th>
                  <th>Barras Necess√°rias</th>
                </tr>
              </thead>
              <tbody>
          `;

          data.forEach((item, index) => {
            const qtdPecas = parseFloat(item.quantidade || 0);
            const compPeca = parseFloat(item.comprimento || 0); // mm
            const barraPadrao = parseFloat(item.barraPadrao || 6000); // mm (6 metros padr√£o)

            const totalComprimento = qtdPecas * compPeca;
            const barrasNecessarias = Math.ceil(totalComprimento / barraPadrao);

            html += `
              <tr>
                <td>${index + 1}</td>
                <td>${item.descricao || "-"}</td>
                <td>${qtdPecas}</td>
                <td>${compPeca}</td>
                <td>${barraPadrao}</td>
                <td>${barrasNecessarias}</td>
              </tr>
            `;
          });

          html += "</tbody></table>";
          resultadoDiv.innerHTML = html;
        } catch (error) {
          resultadoDiv.innerHTML = "Erro ao buscar dados.";
          console.error("Erro:", error);
        }
      }
    </script>
  </body>
</html>
